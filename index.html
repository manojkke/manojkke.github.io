<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.3.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </head>

  <body style="font-size: 14px">
    <div>
      <button style="width: 100%; height: 40px" onclick="getNewsData()">
        Refresh Data
      </button>

      <div></div>
      <div class="row" id="main-container" style="margin-top: 20px">
        <div id="newsSymbol-Sym1" style="padding: 5px">
          <button
            class="btn"
            type="button"
            data-toggle="collapse"
            data-target="#collapseExample-Sym1"
            aria-expanded="false"
            style="width: 100%"
          >
            Symboldfg
          </button>

          <div class="collapse" id="collapseExample-Sym1">
            <div>Anim pariatur cliche</div>
            <div>cliche reprehenderit</div>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

    <script>
      // var script = document.createElement("script");
      // script.src = "https://code.jquery.com/jquery-3.6.3.min.js";
      // document.getElementsByTagName("head")[0].appendChild(script);

      var currentAccessToken = null;

      var allNewsData = [];

      function getDateFormat(params) {
        var d = params;
        var curr_date = d.getDate();
        var curr_month = d.getMonth() + 1;
        if (curr_month < 10) curr_month = "0" + curr_month;
        var curr_year = d.getFullYear();
        var dateString = curr_date + "-" + curr_month + "-" + curr_year;
        dateString = dateString + " 00:00:00";
        console.log(dateString);
      }

      function GetAccessToken() {
        $.ajax({
          url: "https://realm.mongodb.com/api/client/v2.0/app/data-yyhzg/auth/providers/local-userpass/login",
          crossDomain: true,
          method: "post",
          contentType: "application/json",
          data: JSON.stringify({
            username: "manojkke@gmail.com",
            password: "Profit@123",
          }),
        }).done(function (response) {
          currentAccessToken = response.access_token;
          console.log(response);
          getNewsData();
        });
      }

      function getNewsData() {
        $.ajax({
          url: "https://ap-southeast-1.aws.data.mongodb-api.com/app/data-yyhzg/endpoint/data/v1/action/find",
          crossDomain: true,
          method: "post",
          headers: {
            Authorization: "Bearer " + currentAccessToken,
          },
          contentType: "application/json",
          data: JSON.stringify({
            collection: "NewsCollection",
            database: "Trading_news",
            dataSource: "Cluster0",
          }),
        }).done(function (response) {
          allNewsData = response.documents;
          console.log(allNewsData);
          drawNewsContent(allNewsData);
        });
      }

      function drawNewsContent(_allNewsData) {
        $("#main-container").empty();

        for (var n = 0; n < _allNewsData.length; n++) {
          var currentNs = _allNewsData[n];

          var symbolStringForButton = currentNs.Symbol.replace("NYSE", "").replace("NASDAQ", "").replace(":", "");
          if (currentNs.PositiveScore)
            symbolStringForButton =symbolStringForButton + " | P : " + currentNs.PositiveScore;
          if (currentNs.NegativeScore)
            symbolStringForButton =symbolStringForButton + " | N : " + currentNs.NegativeScore;
          if (currentNs.UpgradeDownGradeScore)
            symbolStringForButton =symbolStringForButton +" | U/D : " +currentNs.UpgradeDownGradeScore;

          var newsDetailItems = currentNs.AllNewsDetails;
          var newsDetail_HTM = "";
          for (var nd = 0; nd < newsDetailItems.length; nd++) {
            var curNSDet = newsDetailItems[nd];
            newsDetail_HTM +="  <div >  " +currentNs.Symbol +" : -  : " +curNSDet.Title +"</div>";
            if (curNSDet.PositiveWords.length)
              newsDetail_HTM +="  <div> Positive Words :  " +curNSDet.PositiveWords.join() +"</div>";
            if (curNSDet.NegativeWords.length)
              newsDetail_HTM +="  <div> Negative Words :  " +curNSDet.NegativeWords.join() +"</div>";
            if (curNSDet.UpgradeDownGradeWords.length)
              newsDetail_HTM +="  <div> Up / Dwon Words  :  " +curNSDet.UpgradeDownGradeWords.join() +"</div>";
          }

          var htm ='<div class="col-lg-4 col-sm-12" id="newsSymbol-' +currentNs.Symbol.replace(":", "") +'" style="padding: 5px;">';
          htm +='<button class="btn" type="button" data-toggle="collapse" data-target="#collapseExample-' +currentNs.Symbol.replace(":", "") +'" aria-expanded="false" style="width: 100%" > ' +symbolStringForButton +"</button>";
          htm +=' <div class="collapse" id="collapseExample-' +currentNs.Symbol.replace(":", "") +'">';
          htm += newsDetail_HTM;
          htm += " </div>";
          htm += "</div>";

          $("#main-container").append(htm);
        }
      }

      function executeInJqueryLoaded(method) {
        if (window.jQuery) {
          method();
        } else {
          setTimeout(function () {
            executeInJqueryLoaded(method);
          }, 500);
        }
      }

      executeInJqueryLoaded(function () {
        GetAccessToken();
      });
    </script>
  </body>
</html>
